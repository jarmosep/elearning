var app=angular.module("eLearning",["ui.router","firebase","ngSanitize","ngAnimate"]);app.factory("addWord",function a(){return a.submitWord=function(a,b,c,d,e){e||(e="No example sentences given."),b||(b=null);var f=firebase.auth().currentUser;if(f){var g=firebase.database().ref("users").child(f.uid+"/wordbank"),h=Math.floor(Date.now());g.push({expression:a,reading:b,meaning:c,sentences:e,tags:d,dateAdded:h});var i=firebase.database().ref("users").child(f.uid+"/recentActivity");i.push({activity:a+" added to the wordbank",timestamp:h})}else console.log("Erorrs")},a}),app.factory("authFactory",["$state",function a(b){var c=firebase.database().ref("users"),d=firebase.auth();return a.signup=function(a,e,f){var g=d.createUserWithEmailAndPassword(a,e),h=Math.floor(Date.now());return g.then(function(d){c.child(d.uid).set({displayName:f,email:a,status:"student"});var e=firebase.database().ref("users").child(d.uid+"/recentActivity");e.push({activity:"You created a new account!",timestamp:h}),b.go("dashboard.front"),console.log(d)}).catch(function(a){console.log(a)}),g},a.login=function(a,c){var e=d.signInWithEmailAndPassword(a,c);return e.then(function(a){b.go("dashboard.front"),console.log(a)}).catch(function(a){console.log(a)}),e},a.auth=function(){return console.log(currentUser),d.currentUser},a}]),app.factory("kanjiSearch",["$http",function(a){return{getAllKanjis:function(){var b=a({url:"../api/kanjidict.json",method:"GET",dataType:"jsonp",contentType:"jsonp"});return b.then(function(a){return b.data}),b}}}]);var config={apiKey:"AIzaSyAQCgMuMpoQvh6wlJbVp14t68pOq76y-Kk",authDomain:"elearning-1c775.firebaseapp.com",databaseURL:"https://elearning-1c775.firebaseio.com",storageBucket:"elearning-1c775.appspot.com",messagingSenderId:"595697014369"};firebase.initializeApp(config);var defaultTags=firebase.database().ref("defaultTags"),tags=["adjective-i","adjective-na","adverb","auxiliary","conjunction","common","expression","noun","particle","ichidan-verb","godan-verb","transitive","intransitive","suru-verb","kuru-verb","colloquialism","honorific","onomatopoeic","slang","vulgar","sensitive"];defaultTags.set(tags),app.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("landing",{url:"/",templateUrl:"templates/landing.html",controller:"LoginCtrl"}).state("dashboard",{url:"/dashboard",abstract:!0,templateUrl:"templates/dashboard.html",controller:"DashboardCtrl"}).state("dashboard.front",{url:"",page:"DashboardFront",templateUrl:"templates/mainviews/frontpage.html",controller:"RecentActivityCtrl"}).state("dashboard.wordbank",{templateUrl:"templates/mainviews/wordbank.html",controller:"AllWordsCtrl"}).state("dashboard.word",{url:"/word",templateUrl:"templates/mainviews/singleword.html",controller:"WordDetailsCtrl",params:{obj:null}}).state("dashboard.addword",{templateUrl:"templates/mainviews/addword.html",controller:"WordSubmitCtrl"}).state("dashboard.quiz",{templateUrl:"templates/mainviews/quiz.html",controller:"QuizCtrl"}).state("dashboard.assignments",{templateUrl:"templates/mainviews/assignment.html",controller:"AssignmentsCtrl"}).state("dashboard.askteacher",{templateUrl:"templates/mainviews/ask.html"}),b.otherwise("/")}]),app.controller("AllWordsCtrl",["$scope","$rootScope","$timeout","$state",function(a,b,c,d){a.limit=5,a.showMore=function(){a.limit+=5,c(function(){var a=document.getElementsByTagName("body")[0];a.scrollTop=a.scrollHeight},0,!1)},a.go=function(a){console.log(a),d.go("dashboard.word",{obj:a})},a.words=[],a.filters=[],firebase.auth().onAuthStateChanged(function(d){function e(b){a.words.push(b),console.log(a.words)}if(d){var f=firebase.database().ref("defaultTags"),g=firebase.database().ref("users").child(d.uid+"/wordbank");g.once("value",function(a){var b=a.val();angular.forEach(b,function(a,b){var d={data:a,key:b};c(function(){e(d)})})}),f.once("value",function(b){console.log(b.val()),a.filters.push(b.val())})}else console.log("Not logged in.");a.removeWord=function(c,e){console.log(a.words.indexOf(e)),b.popkey=null,a.words.splice(a.words.indexOf(e),1);var f=firebase.database().ref("users").child(d.uid+"/wordbank");console.log(f.child(c));var g=f.child(c).remove();g.then(function(){console.log("kaik män")}).catch(function(a){console.log(a)})}}),b.activeFilters=[],a.toggleFilter=function(c,d){var e=angular.element(c.currentTarget),f=b.activeFilters.indexOf(d);f>=0?(b.activeFilters.splice(f,1),e.removeClass("active"),a.updateWords()):(b.activeFilters.push(d),e.addClass("active"),a.updateWords())},a.updateWords=function(){for(var b,c=a.words,d=a.activeFilters.sort(),e=0,f=c.length;e<f;e++){b=c[e].tags.sort();var g=d.every(function(a){return b.indexOf(a)>=0});c[e].visible=g}}}]),app.controller("AssignmentsCtrl",["$scope",function(a){a.assignments=[{title:"Basic Japanese - Quiz 4/8",description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Necessitatibus ad soluta perspiciatis totam incidunt officiis doloribus!",due:"29.11.2016 18:30",completed:!1,grade:""},{title:"Basic Japanese - Quiz 3/8",description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Necessitatibus ad soluta perspiciatis totam incidunt officiis doloribus!",due:"22.11.2016 18:30",completed:!0,grade:"A"},{title:"Basic Japanese - Quiz 2/8",description:"Necessitatibus ad soluta perspiciatis totam incidunt officiis doloribus! Lorem ipsum dolor sit amet, consectetur adipisicing elit. ",due:"15.11.2016 18:30",completed:!0,grade:"S"},{title:"Basic Japanese - Quiz 1/8",description:"Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.",due:"15.11.2016 18:30",completed:!0,grade:"S"},{title:"Listening comprehension 1/2",description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Necessitatibus ad soluta perspiciatis totam incidunt officiis doloribus!",due:"7.11.2016 18:30",completed:!0,grade:"C"}]}]),app.controller("DashboardCtrl",["$scope","$state","$timeout","authFactory",function(a,b,c,d){a.state=b,a.obj={},console.log(firebase),firebase.auth().onAuthStateChanged(function(b){if(b){var d=firebase.database().ref("users").child(b.uid);d.on("value",function(b){c(function(){a.obj={displayName:b.val().displayName}},0)})}else console.log("Not logged in.")}),a.logout=function(){var a=firebase.auth().signOut();a.then(function(){b.go("landing")})}}]),app.controller("LoginCtrl",["authFactory","$scope",function(a,b){b.signup=function(b,c,d){a.signup(b,c,d)},b.login=function(b,c){a.login(b,c)}}]),app.controller("RecentActivityCtrl",["$rootScope","$scope","$timeout",function(a,b,c){b.recents=[],firebase.auth().onAuthStateChanged(function(d){function e(a){b.recents.push(a),console.log(b.recents)}if(d){var f=firebase.database().ref("users").child(d.uid+"/recentActivity");f.once("value",function(a){var b=a.val();angular.forEach(b,function(a,b){var d={data:a,key:b};c(function(){e(d)})})})}else console.log("Not logged in.");b.removeActivity=function(c,e){a.popkey=null,console.log(e),b.recents.splice(b.recents.indexOf(e),1);var f=firebase.database().ref("users").child(d.uid+"/recentActivity");console.log(f.child(c));var g=f.child(c).remove();g.then(function(){console.log("kaik män")}).catch(function(a){console.log(a)})}})}]),app.filter("unique",function(){return function(a,b){var c=[],d=[];return angular.forEach(a,function(a){var e=a[b];d.indexOf(e)===-1&&(d.push(e),c.push(a))}),c}}),app.controller("WordDetailsCtrl",["$scope","$state","$stateParams","kanjiSearch",function(a,b,c,d){a.word=c.obj,console.log(a.word.data.expression);var e=a.word.data.expression.split("");a.kanjis=[],a.results=[];for(var f=0;f<e.length;f++)e[f].match(/^[\u4e00-\u9faf]+$/)&&a.kanjis.push(e[f]);a.searchCharacter=function(b){var c=d.getAllKanjis();c.then(function(c){if(a.kanjis.length>=1)for(var d=0;d<a.kanjis.length;d++){var e=c.data.filter(function(a){return a.literal[0]==b[d]});if(e){var f=[];f=e[0],console.log(f),a.results.push(f)}}})},a.chinese=function(a){return"ja_on"==a.$.r_type},a.japanese=function(a){return"ja_kun"==a.$.r_type},0==!a.kanjis.length?a.searchCharacter(a.kanjis):console.log("No kanjis here.")}]),app.controller("WordSubmitCtrl",["$scope","addWord",function(a,b){a.form={},a.onSubmit=function(c,d,e,f,g){b.submitWord(c,d,e,f,g),a.form=null},a.clearFields=function(){a.form=null}}]),app.directive("activity",function(){return{restrict:"E",scope:{recent:"="},templateUrl:"templates/mainviews/partials/frontpage-activity.html"}}),app.directive("assignment",function(){return{restrict:"E",replace:!0,scope:{data:"="},templateUrl:"templates/mainviews/partials/assignment-test.html"}}),app.directive("outsideClick",["$document","$parse",function(a,b){return{restrict:"A",link:function(b,c,d,e){c.bind("click",function(a){a.stopPropagation()}),a.bind("click",function(){b.$apply(d.outsideClick)})}}}]),app.directive("word",function(){return{restrict:"E",scope:{word:"="},templateUrl:"templates/mainviews/partials/wordbank-wordblock.html"}});